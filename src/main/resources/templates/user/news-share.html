<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title th:text="#{title.share.news}">
        News Share - News Group Management
    </title>
    <link rel="stylesheet" th:href="@{/css/user/news-share.css}" />
</head>
<body>
<div class="profile-container">
    <div class="nav-tabs">
        <a
                class="tab-link active"
                data-tab="news-share"
                th:text="#{tab.newsShare}"
        >News Share</a
        >
    </div>

    <div class="section news-share active">
        <form
                class="news-share-form"
                id="news-share-form"
                th:action="@{/api/news/share}"
                method="POST"
                enctype="multipart/form-data"
                onsubmit="return validate()"
        >
            <div class="form-group">
                <label for="news-category" th:text="#{label.category}"
                >Category</label
                >
                <select id="news-category" name="categoryId">
                    <option value="" disabled selected th:text="#{category.select}">
                        Select a Category
                    </option>
                    <option
                            th:each="c : ${categories}"
                            th:value="${c.categoryId}"
                            th:text="${c.name}"
                            th:selected="${newsPost?.categoryId} == ${c.categoryId}"
                    ></option>
                </select>
                <p id="errorCategoryId" class="error-message"></p>
            </div>
            <div class="form-group">
                <label for="news-title" th:text="#{label.title}">Title</label>
                <input
                        type="text"
                        id="news-title"
                        name="title"
                        th:value="${newsPost?.title}"
                        placeholder="Enter news title"
                        th:placeholder="#{placeholder.title}"
                />
                <p id="errorTitle" class="error-message"></p>
            </div>
            <div class="form-group">
                <label for="news-description" th:text="#{label.description}"
                >Description</label
                >
                <textarea
                        id="news-description"
                        name="description"
                        th:text="${newsPost?.description}"
                        placeholder="Enter news description"
                        th:placeholder="#{placeholder.description}"
                ></textarea>
                <p id="errorDescription" class="error-message"></p>
            </div>
            <div class="form-group">
                <label for="news-image" th:text="#{label.image}">Image</label>
                <input type="file" id="news-image" name="file" accept="image/*" />
                <p id="errorFile" class="error-message"></p>
            </div>
            <div class="action-buttons">
                <button
                        type="submit"
                        form="news-share-form"
                        class="save-btn"
                        th:text="#{button.share}"
                >
                    Share News
                </button>
            </div>
        </form>
    </div>
</div>
<script th:inline="javascript">
    const newsShareErrorMessages = {
        categoryRequired:
        /*[[#{error.required.category}]]*/ "Category is required.",
        titleRequired: /*[[#{error.required.title}]]*/ "Title is required.",
        titleInvalid:
        /*[[#{error.invalid.title}]]*/ "Title must be 2-500 characters.",
        descriptionRequired:
        /*[[#{error.required.description}]]*/ "Description is required.",
        descriptionInvalid:
        /*[[#{error.invalid.description}]]*/ "Description must be 2-1000000 characters.",
        imageRequired:
        /*[[#{error.required.image}]]*/ "Please upload an image.",
        imageType:
        /*[[#{error.invalid.image.type}]]*/ "Only JPG, JPEG, or PNG images are allowed.",
        imageSize:
        /*[[#{error.invalid.image.size}]]*/ "Image must be less than 2MB.",
    };
</script>
<script th:src="@{/js/user/news-share.js}"></script>
<!-- jQuery CDN -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $("#news-share-form").on("submit", function (e) {
            e.preventDefault(); // stop default form submit

            $(".error-message").text(""); // clear previous errors

            let formData = new FormData(this);

            $.ajax({
                url: "/api/news/share",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                enctype: "multipart/form-data",
                success: function (response) {
                    if (response.status === "success") {
                        $("#news-share-form")[0].reset();
                        window.location.href = "/"; // redirect to home
                    } else if (response.status === "error") {
                        for (let field in response.errors) {
                            $("#error" + capitalize(field)).text(response.errors[field]);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert("Something went wrong: " + error);
                },
            });
        });

        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
    });
</script>
</body>
</html>